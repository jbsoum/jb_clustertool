apiVersion: v1
kind: ConfigMap
metadata:
  name: authelia-configfile
  namespace: authelia
data:
  configuration.yaml: |
    session:
      expiration: 1h
      inactivity: 5m
      name: authelia_session
      remember_me_duration: 5M
      same_site: lax
      cookies:
        - domain: ${DOMAIN_0}
          authelia_url: https://${SUBDOMAIN_AUTHELIA}.${DOMAIN_0}
    authentication_backend:
      ldap:
        address: ldap://lldap-ldap.lldap.svc.cluster.local:3890
        implementation: "custom"
        timeout: 5s
        tls:
          minimum_version: TLS1.2
          server_name: ""
          skip_verify: true
        user: CN=${AUTHELIA_LLDAP_GROUP_NAME},ou=people,DC=${DC_SUBDOMAIN},DC=${DC_DOMAIN}
        password: ${AUTHELIA_LLDAP_PASSWORD}
        base_dn: dc=${DC_SUBDOMAIN},dc=${DC_DOMAIN}
        additional_users_dn: ou=people
        users_filter: (&(|({username_attribute}={input})({mail_attribute}={input}))(objectClass=person))
        additional_groups_dn: ou=groups
        groups_filter: (member={dn})
        attributes:
          username: uid
          display_name: displayName
          mail: mail
          group_name: cn
    notifier:
      disable_startup_check: true
      smtp:
        address: "smtp://${IP_PROTONMAIL}:${PROTONMAIL_PORT_SMTP}"
        timeout: 5s
        username: ${PROTONMAIL_USER}
        password: ${PROTONMAIL_PASSWORD}
        sender: "MS-Authelia <${PROTONMAIL_USER}>"
        identifier: 127.0.0.1
        subject: "[Authelia] {title}"
        startup_check_address: ${PROTONMAIL_USER}
        disable_require_tls: true
        disable_starttls: true
        disable_html_emails: false
    password_policy:
      standard:
        enabled: false
        max_length: 0
        min_length: 8
        require_lowercase: false
        require_number: false
        require_special: false
        require_uppercase: false
    regulation:
      ban_time: 5m
      find_time: 2m
      max_retries: 3
    theme: dark
    totp:
      issuer: ""
      period: 30
      skew: 1
    access_control:
      default_policy: deny
      rules:
        - domain:
            - "*.${DOMAIN_0}"
          domain_regex: []
          networks: []
          policy: bypass
          resources:
            - ^/api([/?].*)?$
            - ^/share.*$
            - ^/rest.*$
            - ^/editors/onlyoffice.*$
            - ^/identity.*$
            - ^/triggers.*$
            - ^/meshagents.*$
            - ^/meshsettings.*$
            - ^/agent.*$
            - ^/control.*$
            - ^/meshrelay.*$
            - ^/wl.*$
            - ^/emby.*$
          subject: []
        - domain:
            - ${DOMAIN_VAULTWARDEN}
          domain_regex: []
          networks: []
          policy: one_factor
          resources:
            - ^*/admin.*$
          subject: []
        - domain:
            - ${DOMAIN_VAULTWARDEN}
          domain_regex: []
          networks: []
          policy: bypass
          resources: []
          subject: []
        - domain:
            - ${DOMAIN_SEARXNG}
            - ${DOMAIN_KOPIA}
            - ${DOMAIN_LIBREDDIT}
            - ${DOMAIN_VPN}
            - ${DOMAIN_INVIDIOUS}
            - ${DOMAIN_EMBY}
            - ${DOMAIN_JELLYFIN}
            - ${DOMAIN_DOCKER}
          domain_regex: []
          networks: []
          policy: bypass
          resources: []
          subject: []
        - domain:
            - ${DOMAIN_OMBI}
            - ${DOMAIN_LLDAP}
            - ${DOMAIN_EMULATOR_JS}
            - ${DOMAIN_GITEA}
            - ${DOMAIN_VOCECHAT_SERVER}
            - ${DOMAIN_JELLYSEERR}
            - ${DOMAIN_0}
          domain_regex: []
          networks: []
          policy: one_factor
          resources: []
          subject:
            - "group:${LLDAP_USER_GROUP}"
            - "group:${LLDAP_ADMIN_GROUP}"
        - domain:
            - "*.${DOMAIN_0}"
            - ${DOMAIN_0}
          domain_regex: []
          networks: []
          policy: one_factor
          resources: []
          subject:
            - "group:${LLDAP_ADMIN_GROUP}"
