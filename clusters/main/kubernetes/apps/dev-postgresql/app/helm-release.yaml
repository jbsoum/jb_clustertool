apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: dev-postgresql
    namespace: dev-postgresql
spec:
    interval: 15m
    chart:
        spec:
            chart: app-template
            version: 15.3.6
            sourceRef:
                kind: HelmRepository
                name: truecharts
                namespace: flux-system
    releaseName: dev-postgresql
    values:
        image:
            repository: public.ecr.aws/bitnami/postgresql
            pullPolicy: IfNotPresent
            tag: latest@sha256:fb3806e823c271c2b0e0e58134769368749cbcab1db4229c23c300ccdce28058
        global:
            stopAll: false
        TZ: ${TIMEZONE}
        credentials:
            backblaze:
                accessKey: ${S3_ACCESS_KEY}
                bucket: ${S3_BUCKET}
                encrKey: ${S3_ENCRYPTION_KEY}
                name: ${S3_NAME}
                path: ""
                secretKey: ${S3_SECRET_KEY}
                type: s3
                url: ${S3_URL}

        service:
            main:
                ports:
                    main:
                        port: ${PORT_DEV_POSTGRESQL}
                enabled: true
                type: LoadBalancer
                loadBalancerIP: ${IP_DEV_POSTGRESQL}
        persistence:
            data:
                enabled: true
                mountPath: "/bitnami/postgresql"
        workload:
            main:
                podSpec:
                    containers:
                        main:
                            env:
                                POSTGRESQL_USERNAME: ${POSTGRESQL_USERNAME}
                                POSTGRESQL_PASSWORD: ${POSTGRESQL_PASSWORD}
                                POSTGRESQL_DATABASE: ${POSTGRESQL_USERNAME}
                                POSTGRESQL_MASTER_PORT_NUMBER: ${PORT_DEV_POSTGRESQL}
                                POSTGRESQL_TIMEZONE: ${TIMEZONE}
                                POSTGRESQL_LOG_TIMEZONE: ${TIMEZONE}
